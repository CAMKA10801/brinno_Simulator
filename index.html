<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>肯佳企業 - Brinno 縮時相機視角模擬器</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
        .scrollbar-hide::-webkit-scrollbar { display: none; }
        .custom-scrollbar::-webkit-scrollbar { width: 4px; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #444; border-radius: 10px; }
        body { background-color: #111; color: white; overflow-x: hidden; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useMemo, useEffect } = React;
        const { createRoot } = ReactDOM;
        const { Settings, User, Building2, Info, ArrowUpDown, ScanEye, Ruler, ZoomIn } = lucide;

        const App = () => {
            const [scenario, setScenario] = useState('building');
            const [cameraModel, setCameraModel] = useState('TLC2020');
            const [distance, setDistance] = useState(5000);
            const [objHeight, setObjHeight] = useState(3000);
            const [cameraHeight, setCameraHeight] = useState(2000);
            const [tilt, setTilt] = useState(0);
            const [zoomLevel, setZoomLevel] = useState(0);

            const models = {
                'TLC300': { name: 'TLC300', fov: 118, vFov: 60, color: 'bg-blue-600', res: '1080p', desc: '適合長期記錄、輕便好攜帶。' },
                'TLC2020': { name: 'TLC2020', fov: 118, vFov: 60, color: 'bg-yellow-500', res: '1080p', desc: '標準廣角鏡頭 (BCS039)。' },
                'TLC2020_18_55': { name: '18-55mm', fov: '113-48', vFovRange: { min: 58, max: 22 }, color: 'bg-orange-500', res: '1080p', desc: '手動變焦鏡組。' },
                'BCC5000': { name: 'BCC5000', fov: 118, vFov: 60, color: 'bg-purple-600', res: '4K', desc: '4K 超高畫質，旗艦首選。' }
            };

            const config = {
                person: { maxD: 1000, minD: 50, maxH: 400, defD: 300, defH: 170, defCH: 150 },
                building: { maxD: 20000, minD: 500, maxH: 10000, defD: 5000, defH: 3000, defCH: 2000 }
            };

            const currentModel = models[cameraModel];
            const vFov = currentModel.vFovRange ? 
                currentModel.vFovRange.min - (zoomLevel * (currentModel.vFovRange.min - currentModel.vFovRange.max)) : 
                currentModel.vFov;

            const proj = useMemo(() => {
                const angleToHead = Math.atan((objHeight - cameraHeight) / distance) * (180 / Math.PI);
                const angleToFeet = Math.atan((0 - cameraHeight) / distance) * (180 / Math.PI);
                const screenTop = tilt + (vFov / 2);
                return {
                    top: ((screenTop - angleToHead) / vFov) * 100,
                    bottom: ((screenTop - angleToFeet) / vFov) * 100,
                    horizon: (screenTop / vFov) * 100
                };
            }, [distance, objHeight, cameraHeight, tilt, vFov]);

            return (
                <div className="min-h-screen p-4 md:p-8 flex flex-col items-center">
                    <header className="w-full max-w-6xl mb-8 flex flex-col md:flex-row justify-between items-center gap-4 border-b border-neutral-800 pb-6">
                        <div className="flex items-center gap-3">
                            <h1 className="text-2xl font-bold tracking-tight text-white">肯佳企業 <span className="text-neutral-600">|</span> <span className={currentModel.color.replace('bg-', 'text-')}>{currentModel.name}</span></h1>
                        </div>
                        <div className="flex bg-neutral-800 p-1 rounded-lg">
                            {Object.keys(models).map(m => (
                                <button key={m} onClick={() => {setCameraModel(m); setZoomLevel(0);}} className={`px-4 py-2 rounded-md text-sm transition ${cameraModel === m ? models[m].color + ' shadow-lg' : 'text-neutral-500 hover:text-white'}`}>{models[m].name}</button>
                            ))}
                        </div>
                    </header>

                    <main className="w-full max-w-6xl grid grid-cols-1 lg:grid-cols-12 gap-8">
                        {/* 左側控制面板 */}
                        <div className="lg:col-span-5 space-y-4">
                            <div className="bg-neutral-800 p-6 rounded-2xl border border-neutral-700 shadow-xl">
                                <div className="flex justify-between items-center mb-6">
                                    <h2 className="font-bold flex items-center gap-2"><Settings size={20}/> 參數設定</h2>
                                    <div className="flex bg-neutral-900 rounded-lg p-1">
                                        <button onClick={() => {setScenario('person'); setDistance(300); setObjHeight(170); setCameraHeight(150);}} className={`p-2 rounded ${scenario === 'person' ? 'bg-neutral-700' : 'opacity-40'}`}><User size={18}/></button>
                                        <button onClick={() => {setScenario('building'); setDistance(5000); setObjHeight(3000); setCameraHeight(2000);}} className={`p-2 rounded ${scenario === 'building' ? 'bg-neutral-700' : 'opacity-40'}`}><Building2 size={18}/></button>
                                    </div>
                                </div>
                                <div className="space-y-6">
                                    {currentModel.vFovRange && (
                                        <div className="bg-orange-900/20 p-3 rounded-xl border border-orange-800/30">
                                            <div className="flex justify-between text-xs text-orange-400 mb-2"><span>鏡頭焦距</span><span>{Math.round(18 + zoomLevel*37)}mm</span></div>
                                            <input type="range" min="0" max="1" step="0.01" value={zoomLevel} onChange={e => setZoomLevel(Number(e.target.value))} className="w-full accent-orange-500" />
                                        </div>
                                    )}
                                    <div className="space-y-4">
                                        <div>
                                            <div className="flex justify-between text-sm mb-2"><span>拍攝距離</span><span className="text-yellow-500 font-mono">{distance >= 100 ? (distance/100).toFixed(1)+'m' : distance+'cm'}</span></div>
                                            <input type="range" min={config[scenario].minD} max={config[scenario].maxD} value={distance} onChange={e => setDistance(Number(e.target.value))} className="w-full accent-yellow-500" />
                                        </div>
                                        <div className="grid grid-cols-2 gap-4">
                                            <div>
                                                <div className="flex justify-between text-xs mb-2"><span>相機高</span><span className="text-green-500 font-mono">{(cameraHeight/100).toFixed(1)}m</span></div>
                                                <input type="range" min="0" max={config[scenario].maxH} value={cameraHeight} onChange={e => setCameraHeight(Number(e.target.value))} className="w-full h-1 accent-green-500" />
                                            </div>
                                            <div>
                                                <div className="flex justify-between text-xs mb-2"><span>主體高</span><span className="text-blue-500 font-mono">{(objHeight/100).toFixed(1)}m</span></div>
                                                <input type="range" min="50" max={config[scenario].maxH} value={objHeight} onChange={e => setObjHeight(Number(e.target.value))} className="w-full h-1 accent-blue-500" />
                                            </div>
                                        </div>
                                        <div className="bg-neutral-900/50 p-4 rounded-xl border border-neutral-700">
                                            <div className="flex justify-between text-sm mb-2"><span>俯仰角度 (Tilt)</span><span className="text-sky-400 font-bold">{tilt}°</span></div>
                                            <input type="range" min="-60" max="60" value={tilt} onChange={e => setTilt(Number(e.target.value))} className="w-full accent-sky-400" />
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div className="p-4 bg-neutral-800/40 rounded-xl border border-neutral-800 text-[10px] text-neutral-500 flex gap-2"><Info size={14}/><span>數值僅供安裝評估參考，實際畫面受現場環境影響。</span></div>
                        </div>

                        {/* 右側：預覽與 SVG */}
                        <div className="lg:col-span-7 space-y-6">
                            <div className="bg-black rounded-3xl aspect-video relative overflow-hidden border border-neutral-700 shadow-2xl">
                                <div className="absolute inset-0 bg-neutral-900">
                                    <div className="absolute w-full h-full transition-all duration-300" style={{ top: `${proj.horizon - 50}%`, height: '150%' }}>
                                        <div className="h-1/2 bg-sky-950/20"></div>
                                        <div className="h-1/2 bg-neutral-800"></div>
                                        <div className="absolute top-1/2 w-full h-px bg-white/30 shadow-[0_0_10px_white]"></div>
                                    </div>
                                    <div className="absolute left-1/2 -translate-x-1/2 transition-all duration-300 shadow-2xl"
                                         style={{ 
                                            top: `${proj.top}%`, 
                                            height: `${proj.bottom - proj.top}%`, 
                                            width: scenario === 'building' ? '15%' : '8%',
                                            backgroundColor: scenario === 'building' ? '#3b82f6' : '#fbbf24',
                                            borderRadius: '4px',
                                            opacity: 0.9,
                                            border: '1px solid rgba(255,255,255,0.3)'
                                         }}>
                                         <div className="w-full h-full opacity-10" style={{backgroundImage: 'repeating-linear-gradient(0deg, transparent, transparent 10px, white 11px)'}}></div>
                                    </div>
                                    <div className="absolute inset-0 grid grid-cols-3 grid-rows-3 opacity-10 pointer-events-none">
                                        {[...Array(9)].map((_, i) => <div key={i} className="border border-white/20"></div>)}
                                    </div>
                                </div>
                                <div className="absolute top-4 left-4 flex items-center gap-2 bg-black/60 backdrop-blur-md px-3 py-1 rounded-full border border-white/10 text-[10px] font-mono">
                                    <div className="w-1.5 h-1.5 rounded-full bg-red-500 animate-pulse"></div>
                                    PREVIEW | {currentModel.res}
                                </div>
                                {(proj.top < 0 || proj.bottom > 100) && (
                                    <div className="absolute bottom-4 left-4 right-4 bg-red-600/80 text-white text-[10px] px-3 py-2 rounded-lg flex items-center gap-2 animate-bounce">
                                        <Info size={14}/><span>警告：主體部分已超出畫面邊界！</span>
                                    </div>
                                )}
                            </div>

                            {/* 側視 SVG 補回 */}
                            <div className="bg-neutral-800/50 p-4 rounded-2xl border border-neutral-700 h-40 relative">
                                <h3 className="text-[10px] uppercase tracking-widest text-neutral-500 mb-2">Side View 佈局</h3>
                                <svg className="w-full h-full overflow-visible" viewBox="0 0 400 100">
                                    <line x1="0" y1="90" x2="400" y2="90" stroke="#444" strokeWidth="1" />
                                    {/* 相機 */}
                                    <g transform={`translate(40, ${90 - (cameraHeight/config[scenario].maxH)*80})`}>
                                        <rect x="-8" y="-8" width="16" height="16" fill={currentModel.iconColor || '#888'} rx="2" stroke="white" strokeWidth="1" />
                                        <line x1="0" y1="0" x2="300" y2={-tilt} stroke="white" strokeOpacity="0.2" strokeDasharray="4" />
                                    </g>
                                    {/* 主體 */}
                                    <rect x={40 + (distance/config[scenario].maxD)*300} y={90 - (objHeight/config[scenario].maxH)*80} width="10" height={(objHeight/config[scenario].maxH)*80} fill="#3b82f6" fillOpacity="0.5" stroke="#3b82f6" />
                                </svg>
                            </div>
                        </div>
                    </main>
                </div>
            );
        };

        const root = createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>

<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>肯佳企業 - Brinno 視角模擬器</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
        .scrollbar-hide::-webkit-scrollbar { display: none; }
        body { background-color: #171717; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        // 嚴格的全域變數提取
        const useState = React.useState;
        const useMemo = React.useMemo;
        const useEffect = React.useEffect;
        const createRoot = ReactDOM.createRoot;
        
        // 圖示提取
        const { Settings, User, Building2, Info } = lucide;

        const App = () => {
            const [scenario, setScenario] = useState('building');
            const [cameraModel, setCameraModel] = useState('TLC2020');
            const [distance, setDistance] = useState(5000);
            const [objHeight, setObjHeight] = useState(3000);
            const [cameraHeight, setCameraHeight] = useState(2000);
            const [tilt, setTilt] = useState(0);
            const [zoomLevel, setZoomLevel] = useState(0);

            const models = {
                'TLC300': { name: 'TLC300', fov: 118, vFov: 60, color: 'bg-blue-600', res: '1080p' },
                'TLC2020': { name: 'TLC2020', fov: 118, vFov: 60, color: 'bg-yellow-500', res: '1080p' },
                'TLC2020_18_55': { name: '18-55mm', fov: '113-48', vFovRange: { min: 58, max: 22 }, color: 'bg-orange-500', res: '1080p' },
                'BCC5000': { name: 'BCC5000', fov: 118, vFov: 60, color: 'bg-purple-600', res: '4K' }
            };

            const currentModel = models[cameraModel];
            const vFov = currentModel.vFovRange ? 
                currentModel.vFovRange.min - (zoomLevel * (currentModel.vFovRange.min - currentModel.vFovRange.max)) : 
                currentModel.vFov;

            const proj = useMemo(() => {
                const angleToHead = Math.atan((objHeight - cameraHeight) / distance) * (180 / Math.PI);
                const angleToFeet = Math.atan((0 - cameraHeight) / distance) * (180 / Math.PI);
                const screenTop = tilt + (vFov / 2);
                return {
                    top: ((screenTop - angleToHead) / vFov) * 100,
                    bottom: ((screenTop - angleToFeet) / vFov) * 100,
                    horizon: (screenTop / vFov) * 100
                };
            }, [distance, objHeight, cameraHeight, tilt, vFov]);

            const config = {
                person: { maxD: 1000, maxH: 300, defD: 300, defH: 170, defCH: 150 },
                building: { maxD: 20000, maxH: 10000, defD: 5000, defH: 3000, defCH: 2000 }
            };

            const changeScenario = (s) => {
                setScenario(s);
                setDistance(config[s].defD);
                setObjHeight(config[s].defH);
                setCameraHeight(config[s].defCH);
            };

            return (
                <div className="min-h-screen text-white p-4 md:p-8 max-w-6xl mx-auto">
                    <header className="flex justify-between items-center mb-8 border-b border-neutral-800 pb-4">
                        <h1 className="text-xl font-bold">Brinno 視角模擬器</h1>
                        <div className="flex bg-neutral-800 p-1 rounded gap-1">
                            {Object.keys(models).map(m => (
                                <button key={m} onClick={() => setCameraModel(m)} 
                                    className={`px-3 py-1 rounded text-xs ${cameraModel === m ? models[m].color : 'text-neutral-500'}`}>
                                    {models[m].name}
                                </button>
                            ))}
                        </div>
                    </header>

                    <div className="grid grid-cols-1 lg:grid-cols-12 gap-8">
                        <div className="lg:col-span-5 space-y-6">
                            <div className="bg-neutral-800 p-6 rounded-xl border border-neutral-700">
                                <div className="flex justify-between mb-6">
                                    <h2 className="flex items-center gap-2"><Settings size={18}/> 參數設定</h2>
                                    <div className="flex bg-neutral-900 rounded p-1">
                                        <button onClick={() => changeScenario('person')} className={`p-1 ${scenario === 'person' ? 'bg-neutral-600' : ''}`}><User size={16}/></button>
                                        <button onClick={() => changeScenario('building')} className={`p-1 ${scenario === 'building' ? 'bg-neutral-600' : ''}`}><Building2 size={16}/></button>
                                    </div>
                                </div>

                                <div className="space-y-4">
                                    {currentModel.vFovRange && (
                                        <div>
                                            <label className="text-xs text-orange-400">變焦 (18-55mm)</label>
                                            <input type="range" min="0" max="1" step="0.01" value={zoomLevel} onChange={e => setZoomLevel(Number(e.target.value))} className="w-full h-1 accent-orange-500" />
                                        </div>
                                    )}
                                    <div>
                                        <label className="text-xs text-yellow-500">拍攝距離: {Math.round(distance/100)}m</label>
                                        <input type="range" min="100" max={config[scenario].maxD} value={distance} onChange={e => setDistance(Number(e.target.value))} className="w-full h-1 accent-yellow-500" />
                                    </div>
                                    <div>
                                        <label className="text-xs text-green-500">相機高度: {Math.round(cameraHeight/100)}m</label>
                                        <input type="range" min="0" max={config[scenario].maxH} value={cameraHeight} onChange={e => setCameraHeight(Number(e.target.value))} className="w-full h-1 accent-green-500" />
                                    </div>
                                    <div>
                                        <label className="text-xs text-sky-500">俯仰角度: {tilt}°</label>
                                        <input type="range" min="-60" max="60" value={tilt} onChange={e => setTilt(Number(e.target.value))} className="w-full h-1 accent-sky-500" />
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div
